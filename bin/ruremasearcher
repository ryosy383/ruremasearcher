#!/usr/bin/env ruby

require '../lib/AutoRedirector'
require '../lib/ruremasearcher'
require 'thor'

module RuremaSearcher
  class CLI < Thor
    class_option :help, type: :boolean, aliases: '-h', desc: 'help message.'
    class_option :version, type: :boolean, desc: 'version'
    default_task :search

    desc 'search', 'Search in http://rurema.clear-code.com/'
    def search(words)
      agent = 'Linux Firefox'
      url = 'http://rurema.clear-code.com/'
      ar = AutoRedirector.new(agent)
      ar.get(url)
      search_result = ar.search(words)
      # ---- DEBUG ----
      p search_result.body.toutf8
      #----------------
      exit(true)
    rescue => e
      warn(e.message)
      exit(false)
    end

    desc 'version', 'version'
    def version
      p RuremaSearcher::VERSION
    end
  end
end

RuremaSearcher::CLI.start(ARGV)
